<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Mastering Metrics - The Path from Cause to Effect | Double-Tea's Blog</title><meta name="keywords" content="Statistics"><meta name="author" content="Double-Tea"><meta name="copyright" content="Double-Tea"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Randomized TrialsThis chapter explains the “random assignment” using two randomized evaluations of the effects of health insurance.   Example 1: Insurance Coverage -&gt; Healthier? An apples to orange">
<meta property="og:type" content="article">
<meta property="og:title" content="Mastering Metrics - The Path from Cause to Effect">
<meta property="og:url" content="https://double-tea-l.github.io/2022/06/27/Mastering-metrics/index.html">
<meta property="og:site_name" content="Double-Tea&#39;s Blog">
<meta property="og:description" content="Randomized TrialsThis chapter explains the “random assignment” using two randomized evaluations of the effects of health insurance.   Example 1: Insurance Coverage -&gt; Healthier? An apples to orange">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://double-tea-l.github.io/img/avatar.PNG">
<meta property="article:published_time" content="2022-06-27T04:00:00.000Z">
<meta property="article:modified_time" content="2022-06-29T04:24:31.597Z">
<meta property="article:author" content="Double-Tea">
<meta property="article:tag" content="Statistics">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://double-tea-l.github.io/img/avatar.PNG"><link rel="shortcut icon" href="/img/avatar.png"><link rel="canonical" href="https://double-tea-l.github.io/2022/06/27/Mastering-metrics/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-EMG0JR1MGM"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EMG0JR1MGM');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: Double-Tea","link":"Link: ","source":"Source: Double-Tea's Blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Mastering Metrics - The Path from Cause to Effect',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-06-29 00:24:31'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f0f5f5')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.PNG" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archive</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Double-Tea's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archive</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Mastering Metrics - The Path from Cause to Effect</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2022-06-27T04:00:00.000Z" title="Created 2022-06-27 00:00:00">2022-06-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Study-Notes/">Study Notes</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">609</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>3min</span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/2022/06/27/Mastering-metrics/#post-comment"><span class="gitalk-comment-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div><article class="post-content" id="article-container"><h1 id="Randomized-Trials"><a href="#Randomized-Trials" class="headerlink" title="Randomized Trials"></a>Randomized Trials</h1><p>This chapter explains the “random assignment” using two randomized evaluations of the effects of health insurance.  </p>
<p>Example 1: Insurance Coverage -&gt; Healthier?</p>
<p>An apples to oranges comparison. </p>
<p>Many variables can be highly correlated to the “effect” as well as to the “cause”. </p>
<p>e.g. People with health insurance are better educated, have higher income, more likely to be working than the uninsured. </p>
<p>better educated -&gt; exercise more, smoke les, more likely to wear seat belts (better habits &amp; more knowledge) -&gt; healthier<br>higher income -&gt; healthy food, safer neighborhood, better living environment, etc. -&gt; healthier</p>
<h2 id="Selection-bias"><a href="#Selection-bias" class="headerlink" title="Selection bias"></a>Selection bias</h2><table>
<thead>
<tr>
<th align="center">No.</th>
<th align="center">def.</th>
<th align="center">sign</th>
<th align="center">Product A</th>
<th align="center">Product B</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">Potential outcome w&#x2F;o OP</td>
<td align="center">$Y_{0i}$</td>
<td align="center">20%</td>
<td align="center">25%</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">Potential outcome w&#x2F; OP</td>
<td align="center">$Y_{1i}$</td>
<td align="center">18%</td>
<td align="center">25%</td>
</tr>
<tr>
<td align="center">2-1</td>
<td align="center">Treatment (OP status chosen)</td>
<td align="center">$D_i$</td>
<td align="center">-200 bps</td>
<td align="center">0 bps</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">Actual OP outcome</td>
<td align="center">$Y_i$</td>
<td align="center">18%</td>
<td align="center">25%</td>
</tr>
<tr>
<td align="center">2-1</td>
<td align="center">Treatment effect</td>
<td align="center">$Y_{1i} - Y_{0i}$</td>
<td align="center">-200 bps</td>
<td align="center">0 bps</td>
</tr>
</tbody></table>
<p>When comparing results directly, we may see product A outperformed product B with OP. However, A and B is not comparable because they did not start off from the same baseline. This is called “selection bias”. </p>
<p>$$Y_{A} - Y_{B} &#x3D; Y_{1A} - Y_{1b} &#x3D; (Y_{1A} - Y_{0A}) + (Y_{1B} - Y_{0B}) + (Y_{0A} - Y_{0B}) $$</p>
<p>$$ Avg_n[Y_{1i} - Y_{0i}] &#x3D; \frac{1}{n} \sum_{i&#x3D;1}^{n}[Y_{1i} - Y_{0i}] $$</p>
<p>Differences in group mean &#x3D; Average causal effect (k) + Selection bias </p>
<p>If the only source of selection bias is a set of differences in characteristics that we can observe and measure, sleection bias is relatively easy to fix - simply control those varaibles. The principal challenge facing is elimination of the selection bias that arises from unobserved differences. </p>
<h2 id="Experimental-random-assignment"><a href="#Experimental-random-assignment" class="headerlink" title="Experimental random assignment"></a>Experimental random assignment</h2><p>eliminates selection bias</p>
<p>We must randomly assign treatment in a sample that’s large enough to ensure that differences in individual characteristics wash out. </p>
<p><strong>Law of Large Number (LLN, 大数定律)</strong><br>Two randomly chosen groups, when large enough, are indeed comparable. The larger the sample, the closer the sample average to the average in the population from which it is drawn. 样本越大，其均值越接近总体的均值。</p>
<p>$$ (1 * \frac{1}{6}) + (2 * \frac{1}{6}) + (3 * \frac{1}{6})+ (4 * \frac{1}{6})+ (5 * \frac{1}{6})+ (6 * \frac{1}{6}) &#x3D; \frac{1+2+3+4+5+6}{6} &#x3D; 3.5 $$</p>
<p><strong>Mathmatical Expectation (数学期望)</strong> </p>
<p>$ E[Y_{i}] $ is the average in infinitely many repititions of a process such as rolling a fair dice. </p>
<p>randomly assigned groups should be similar in every way, including in ways that we cannot easily measure or observe. </p>
<p><strong>Conditional Expectation (条件期望)</strong> </p>
<p>BG: Affordable Care Act (ACA) requires Americans to buy health insurance, with a tax penalty for those who don’t voluntarily buy in. The US spends more of its GDP on health care than do other developed nations, yet Amercians are surprisingly unhealthy. </p>
<p>Medicare: covers elderly<br>Medicaid: poor Americans<br>Uninsured: working, prime-age poor<br>Employer-provided insurance: working class</p>
<p>Question: would gov. mandated health insurance yield a health dividend?</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Ceteris_paribus"><em>ceteris paribus</em></a>: the health of someone w&#x2F; insurance coverage v.s. the health of the same person w&#x2F;o insurance<br>conundrum: a same person cannot be both insured and not insured at the same time</p>
<!-- > The Road Not Taken
> Two roads diverged in a yellow wood,
> And sorry I could not travel both
> And be one traveler, long I stood
> And loooked down one as far as I could
> To where it bent in the undergrowth;
> Two roads diverged in a wood, and I -
> I took the one less traveled by, 
> And that has made all the difference.  -->

<!-- Acts demolish their alternatives, that is the paradox. We can't know what lies at the end of the road not taken.  -->


<p>Nation Health Interview Survey (NHIS)</p>
<p>sample: a sample of married 2009 NHIS respondents</p>
<p>treatment group: coverage by private health insurance<br>control group: without private health insurance<br>(a good control group reveals the fate of the treated in a counterfactual world where they are not treated.)</p>
<h1 id="Regression"><a href="#Regression" class="headerlink" title="Regression"></a>Regression</h1><h1 id="Instrumental-Variables"><a href="#Instrumental-Variables" class="headerlink" title="Instrumental Variables"></a>Instrumental Variables</h1><h1 id="Regression-Discontinuity-Designs"><a href="#Regression-Discontinuity-Designs" class="headerlink" title="Regression Discontinuity Designs"></a>Regression Discontinuity Designs</h1><h1 id="Differences-in-Differences"><a href="#Differences-in-Differences" class="headerlink" title="Differences-in-Differences"></a>Differences-in-Differences</h1><h1 id="The-Wages-of-Schooling"><a href="#The-Wages-of-Schooling" class="headerlink" title="The Wages of Schooling"></a>The Wages of Schooling</h1></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Statistics/">Statistics</a></div><div class="post_share"></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Randomized-Trials"><span class="toc-number">1.</span> <span class="toc-text">Randomized Trials</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Selection-bias"><span class="toc-number">1.1.</span> <span class="toc-text">Selection bias</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Experimental-random-assignment"><span class="toc-number">1.2.</span> <span class="toc-text">Experimental random assignment</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Regression"><span class="toc-number">2.</span> <span class="toc-text">Regression</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Instrumental-Variables"><span class="toc-number">3.</span> <span class="toc-text">Instrumental Variables</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Regression-Discontinuity-Designs"><span class="toc-number">4.</span> <span class="toc-text">Regression Discontinuity Designs</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Differences-in-Differences"><span class="toc-number">5.</span> <span class="toc-text">Differences-in-Differences</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-Wages-of-Schooling"><span class="toc-number">6.</span> <span class="toc-text">The Wages of Schooling</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By Double-Tea</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'a8ee3bd8fb735ffabde9',
      clientSecret: 'e852bd9058f3f6646291b1a6819f92ed10d5b874',
      repo: 'double-tea-l.github.io',
      owner: 'double-tea-l',
      admin: ['double-tea-l'],
      id: 'd6d6ec3b6d7e6adb6495ef4757aefdf9',
      updateCountCallback: commentCount
    },))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', 'G-EMG0JR1MGM', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script></div></body></html>